<!DOCTYPE html>
<html>
<head>
    <title>Data Table</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; padding: 40px; background-color: #f4f6f9; font-family: 'Montserrat', sans-serif; color: #333; }
        h2 { text-align: left; font-weight: 200;  color: #2c3e50; }
        table { border-collapse: separate; border-spacing: 0; width: 100%; margin: 20px 0; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        th, td { padding: 14px 16px; text-align: left; }
        th { background-color: #2c3e50; color: white; font-weight: 500; font-size: 10px; text-transform: uppercase; letter-spacing: 0.05em; }
        tr:nth-child(even) td { background-color: #f9fbfd; }
        tr:hover td { background-color: #eef3f9; }
        td { font-size: 14px; color: #444; border-bottom: 1px solid #eee; }
        .totals-summary { margin-top: 30px; padding: 20px; background-color: #fff; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        .totals-summary h3 { margin-top: 0; font-size: 18px; font-weight: 600; color: #2c3e50; margin-bottom: 15px; }
        .totals-item { margin: 8px 0; font-size: 15px; font-weight: 500; color: #555; }
        .totals-item span { font-weight: 600; color: #000; }
        .sender-info { padding: 20px; padding-top: 2px; padding-bottom: 2px; background-color: #fff; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); border: 1px solid #eee; }
    </style>
</head>
<body>
     <div class="sender-info" id="sender-info">
        <h2>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:</h2>
    </div>

    <table id="data-table">
        <thead></thead>
        <tbody></tbody>
    </table>

    <!-- üîò –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <button id="copy-btn" style="
        margin-top: 15px;
        padding: 10px 16px;
        border: none;
        border-radius: 8px;
        background-color: #2c3e50;
        color: white;
        font-weight: 500;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    ">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
    
    <div class="totals-summary" id="totals-summary">
        <h3>–ò—Ç–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É:</h3>
    </div>

    <script>
        async function fetchData() {
            const response = await fetch('/table/json');
            const data = await response.json();

            const table = document.getElementById("data-table");
            const thead = table.querySelector("thead");
            const tbody = table.querySelector("tbody");

            // üîπ –ê–≤—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏–∑ –∫–ª—é—á–µ–π –ø–µ—Ä–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
            thead.innerHTML = "";
            if (data.rows.length > 0) {
                const headerRow = document.createElement("tr");
                Object.keys(data.rows[0]).forEach(key => {
                    const th = document.createElement("th");
                    th.textContent = key;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
            }

            // üîπ –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–∞–Ω–Ω—ã–º–∏
            tbody.innerHTML = "";
            data.rows.forEach(row => {
                const tr = document.createElement("tr");
                Object.values(row).forEach(value => {
                    const td = document.createElement("td");
                    td.textContent = value;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            // üîπ –°–ª–æ–≤–∞—Ä—å –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –∏—Ç–æ–≥–æ–≤
            const totalsNames = {
                total_quantity: "–û–±—â–µ–µ –∫–æ–ª-–≤–æ –º–µ—Å—Ç",
                total_weight: "–û–±—â–∏–π –≤–µ—Å –±—Ä—É—Ç—Ç–æ",
                total_amount: "–û–±—â–∞—è —Å—É–º–º–∞"
            };

            // üîπ –ò—Ç–æ–≥–∏
            const totalsDiv = document.getElementById("totals-summary");
            totalsDiv.innerHTML = `
                <h3>–ò—Ç–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É:</h3>
                ${Object.entries(data.totals).map(([key, val]) => `
                    <div class="totals-item">${totalsNames[key] || key}: <span>${val}</span></div>
                `).join('')}
            `;
            const SenderInfo = document.getElementById("sender-info");
            SenderInfo.innerHTML = `
                <h2>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å: <a style="font-weight: 600;">${data.sender}</a></h2>
                <h2>–ù–æ–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: <a style="font-weight: 600;">${data.truck}</a></h2>
            `;

            console.log("Data as table:");
            console.table(data.rows);
            console.log("Totals:");
            console.table(data.totals);
            console.log("Sender:");
            console.table(data.sender);
            console.log("Truck:");
            console.table(data.truck);
        }

        fetchData();

        // üîπ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±—É—Ñ–µ—Ä
        document.getElementById("copy-btn").addEventListener("click", () => {
            const table = document.getElementById("data-table");
            let text = "";

            // –ó–∞–≥–æ–ª–æ–≤–∫–∏
            

            // –°—Ç—Ä–æ–∫–∏
            table.querySelectorAll("tbody tr").forEach(row => {
                const cells = [...row.querySelectorAll("td")].map(td => td.textContent.trim());
                text += cells.join("\t") + "\n";
            });

            navigator.clipboard.writeText(text).then(() => {
                alert("–¢–∞–±–ª–∏—Ü–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
            }).catch(err => {
                console.error("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:", err);
            });
        });

    </script>
</body>
</html>
